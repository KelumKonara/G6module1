<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Lab - Grade 6</title>
    <style>
        :root { 
            --primary: #6c5ce7; --secondary: #a29bfe; --dark: #2d3436; 
            --accent: #fdce2e; --bg: #0f0c29; --success: #00b894; --danger: #d63031;
        }
        
        body, html { 
            margin: 0; padding: 0; height: 100vh; width: 100vw; 
            overflow: hidden; font-family: 'Segoe UI', 'Nirmala UI', sans-serif;
            display: flex; flex-direction: column; 
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
        }
        
        header { 
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            color: white; text-align: center; padding: 12px; 
            border-bottom: 2px solid var(--secondary); position: relative;
        }
        header h1 { margin: 0; font-size: 1.4rem; text-shadow: 0 0 10px var(--secondary); }

        #fs-toggle {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1); border: 1px solid var(--secondary);
            color: white; padding: 8px; border-radius: 10px; cursor: pointer;
        }

        .main-container { flex: 1; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; overflow: hidden; }
        
        .tab-wrapper { display: flex; gap: 10px; margin-bottom: 10px; }
        .tab-btn { 
            flex: 1; padding: 12px; border: none; border-radius: 15px;
            background: rgba(255,255,255,0.1); color: white; cursor: pointer; 
            font-weight: bold; border: 1px solid rgba(255,255,255,0.2);
        }
        .tab-btn.active { background: var(--primary); box-shadow: 0 0 15px var(--primary); }

        .content { 
            background: rgba(255, 255, 255, 0.95); flex: 1; border-radius: 20px; 
            display: none; padding: 12px; flex-direction: column; position: relative;
        }
        .content.active { display: flex; }

        /* Attractive Paint Area */
        .canvas-container { 
            flex: 1; position: relative; border: 3px solid var(--primary); 
            border-radius: 15px; background: white; overflow: hidden;
            box-shadow: 0 0 20px rgba(108, 92, 231, 0.2);
        }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; touch-action: none; }
        #previewCanvas { z-index: 5; pointer-events: none; }
        #canvas { z-index: 1; cursor: crosshair; }

        .tools { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-top: 10px; }
        .tool { 
            padding: 10px; border: 2px solid #ddd; border-radius: 12px; 
            background: white; font-size: 1.3rem; cursor: pointer; transition: 0.3s;
        }
        .tool.active { 
            border-color: var(--primary); background: #efecff; 
            box-shadow: 0 0 15px var(--primary); transform: scale(1.05);
        }
        .save-btn { background: var(--success); color: white; border: none; border-radius: 12px; font-weight: bold; grid-column: span 2; }

        /* Typing Area */
        #typing { background: #1e272e; }
        #stage-area { flex: 1; position: relative; background: radial-gradient(circle, #2c3e50, #000000); border-radius: 15px; overflow: hidden; }
        .letter { position: absolute; color: var(--accent); font-size: 45px; font-weight: 900; text-shadow: 0 0 15px var(--accent); transition: transform 0.1s; }
        
        /* Keyboard Styling */
        #virtual-keyboard { 
            display: flex; flex-direction: column; gap: 5px; padding: 10px; 
            background: rgba(0,0,0,0.5); border-radius: 15px; margin-top: 5px;
        }
        .kb-row { display: flex; justify-content: center; gap: 4px; }
        .key { 
            background: #4b4b4b; color: white; border: none; flex: 1; 
            max-width: 45px; height: 45px; border-radius: 8px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 0 #222;
        }
        .key:active { background: var(--primary); transform: translateY(2px); box-shadow: 0 2px 0 #222; }

        /* Pop-up Overlays */
        .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(15, 12, 41, 0.9); display: flex; flex-direction: column; 
            justify-content: center; align-items: center; z-index: 100; color: white; text-align: center;
        }
        .overlay h2 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 0 20px var(--accent); }
        .btn-start { padding: 15px 40px; font-size: 1.2rem; font-weight: bold; background: var(--accent); border: none; border-radius: 50px; cursor: pointer; color: var(--dark); }

        footer { color: rgba(255,255,255,0.4); text-align: center; padding: 5px; font-size: 0.7rem; }
    </style>
</head>
<body onkeydown="hideVK()">

<header>
    <h1>üöÄ SMART LAB - GRADE 6</h1>
    <button id="fs-toggle" onclick="toggleFS()">‚õ∂</button>
</header>

<div class="main-container">
    <div class="tab-wrapper">
        <button class="tab-btn active" id="btn-p" onclick="showTab('paint')">üé® Paint Game</button>
        <button class="tab-btn" id="btn-t" onclick="showTab('typing')">‚å®Ô∏è Typing Game </button>
    </div>

    <div id="paint" class="content active">
        <div class="canvas-container" id="p-box" onpointerdown="showVK()">
            <canvas id="canvas"></canvas>
            <canvas id="previewCanvas"></canvas>
        </div>
        <div class="tools">
            <input type="color" id="color" value="#6c5ce7" style="width:100%; height:45px; cursor:pointer; border:none; border-radius:10px;">
            <button class="tool active" id="brushBtn" onclick="setTool('brush')">üñåÔ∏è</button>
            <button class="tool" id="lineBtn" onclick="setTool('line')">üìè</button>
            <button class="tool" id="rectBtn" onclick="setTool('rect')">‚¨ú</button>
            <button class="tool" id="circleBtn" onclick="setTool('circle')">‚≠ï</button>
            <button class="tool" id="bucketBtn" onclick="setTool('bucket')">ü™£</button>
            <button class="tool" id="eraserBtn" onclick="setTool('eraser')">üßΩ</button>
            <button class="tool" onclick="undo()">‚ü≤</button>
            <button class="tool" onclick="redo()">‚ü≥</button>
            <button class="tool" onclick="clearCanvas()">üóëÔ∏è</button>
            <button class="save-btn" onclick="saveImage()">üíæ SAVE ART</button>
        </div>
    </div>

    <div id="typing" class="content">
        <div class="score-board" style="display:flex; justify-content: space-between; color: white; padding: 5px 15px; font-weight: bold;">
            <span>STAGE: <span id="stageLevel" style="color:var(--accent)">1</span></span>
            <span id="livesText">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
            <span>SCORE: <span id="scoreNum" style="color:var(--accent)">0</span></span>
        </div>
        <div id="stage-area" onpointerdown="showVK()">
            <div id="start-overlay" class="overlay">
                <h2>READY FOR TAKEOFF?</h2>
                <button class="btn-start" onclick="startGame()">START MISSION</button>
            </div>
            <div id="stage-complete-overlay" class="overlay" style="display:none;">
                <h2 id="stage-complete-text" style="color: var(--success);">STAGE 1 COMPLETED!</h2>
                <button class="btn-start" onclick="nextStage()">NEXT STAGE üöÄ</button>
            </div>
            <div id="win-overlay" class="overlay" style="display:none;">
                <h2 style="color: gold;">üèÜ CONGRATULATIONS! üèÜ</h2>
                <p style="font-size: 1.5rem;">YOU COMPLETED ALL MISSIONS!</p>
                <button class="btn-start" onclick="startGame()">PLAY AGAIN</button>
            </div>
            <div id="game-over" class="overlay" style="display:none;">
                <h2 style="color:var(--danger)">MISSION FAILED</h2>
                <button class="btn-start" onclick="startGame()">RETRY</button>
            </div>
        </div>
        <div id="virtual-keyboard"></div>
    </div>
</div>

<footer>Developer | Kelum Konara | SmartSoft | ¬© 2026</footer>

<script>
    const cvs = document.getElementById('canvas'), ctx = cvs.getContext('2d', {willReadFrequently:true});
    const pcvs = document.getElementById('previewCanvas'), pctx = pcvs.getContext('2d');
    const vk = document.getElementById('virtual-keyboard');
    let tool='brush', drawing=false, startX, startY, undoStack=[], redoStack=[], activeTab='paint';

    // UI Logic
    function hideVK() { vk.style.display = 'none'; }
    function showVK() { if(activeTab === 'typing') vk.style.display = 'flex'; }
    function toggleFS() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else document.exitFullscreen();
    }

    function showTab(tab) {
        activeTab = tab;
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        document.getElementById('btn-' + (tab === 'paint' ? 'p' : 't')).classList.add('active');
        if(tab==='paint') { hideVK(); init(); } else { showVK(); }
    }

    function init() {
        const box = document.getElementById('p-box');
        if(!box) return;
        cvs.width = pcvs.width = box.clientWidth; cvs.height = pcvs.height = box.clientHeight;
        ctx.fillStyle="white"; ctx.fillRect(0,0,cvs.width,cvs.height);
    }
    window.onload = init; window.onresize = init;

    // --- Paint Logic ---
    function getPos(e) {
        const r = cvs.getBoundingClientRect();
        const ev = e.touches ? e.touches[0] : e;
        return { x: ev.clientX - r.left, y: ev.clientY - r.top };
    }

    const startDraw = (e) => {
        if(activeTab !== 'paint') return;
        const pos = getPos(e); startX = pos.x; startY = pos.y;
        undoStack.push(cvs.toDataURL()); redoStack = [];
        if(tool==='bucket') fillCanvas(Math.floor(startX), Math.floor(startY));
        else { drawing=true; ctx.beginPath(); ctx.moveTo(startX, startY); }
    };

    const moveDraw = (e) => {
        if(!drawing) return;
        const pos = getPos(e);
        const c = document.getElementById('color').value;
        if(tool==='brush' || tool==='eraser'){
            ctx.lineWidth = tool==='eraser'?35:5; ctx.strokeStyle = tool==='eraser'?'#fff':c;
            ctx.lineCap='round'; ctx.lineTo(pos.x, pos.y); ctx.stroke();
        } else {
            pctx.clearRect(0,0,pcvs.width,pcvs.height); pctx.strokeStyle=c; pctx.lineWidth=3;
            if(tool==='line'){ pctx.beginPath(); pctx.moveTo(startX,startY); pctx.lineTo(pos.x,pos.y); pctx.stroke(); }
            if(tool==='rect') pctx.strokeRect(startX,startY,pos.x-startX,pos.y-startY);
            if(tool==='circle') { let d=Math.sqrt((pos.x-startX)**2+(pos.y-startY)**2); pctx.beginPath(); pctx.arc(startX,startY,d,0,Math.PI*2); pctx.stroke(); }
        }
    };

    const stopDraw = (e) => {
        if(!drawing) return; drawing=false;
        const pos = getPos(e.changedTouches ? e.changedTouches[0] : e);
        ctx.strokeStyle = document.getElementById('color').value; ctx.lineWidth = 5;
        if(tool==='line'){ ctx.beginPath(); ctx.moveTo(startX,startY); ctx.lineTo(pos.x,pos.y); ctx.stroke(); }
        if(tool==='rect') ctx.strokeRect(startX,startY,pos.x-startX,pos.y-startY);
        if(tool==='circle') { let d=Math.sqrt((pos.x-startX)**2+(pos.y-startY)**2); ctx.beginPath(); ctx.arc(startX,startY,d,0,Math.PI*2); ctx.stroke(); }
        pctx.clearRect(0,0,pcvs.width,pcvs.height);
    };

    cvs.addEventListener('mousedown', startDraw);
    cvs.addEventListener('mousemove', moveDraw);
    window.addEventListener('mouseup', stopDraw);
    cvs.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, {passive:false});
    cvs.addEventListener('touchmove', (e) => { e.preventDefault(); moveDraw(e); }, {passive:false});
    cvs.addEventListener('touchend', stopDraw);

    function setTool(t) { tool=t; document.querySelectorAll('.tool').forEach(b=>b.classList.remove('active')); document.getElementById(t+'Btn').classList.add('active'); }
    function undo() { if(undoStack.length){ redoStack.push(cvs.toDataURL()); let img=new Image(); img.src=undoStack.pop(); img.onload=()=>ctx.drawImage(img,0,0); } }
    function redo() { if(redoStack.length){ undoStack.push(cvs.toDataURL()); let img=new Image(); img.src=redoStack.pop(); img.onload=()=>ctx.drawImage(img,0,0); } }
    function clearCanvas() { undoStack.push(cvs.toDataURL()); ctx.fillStyle="white"; ctx.fillRect(0,0,cvs.width,cvs.height); }
    function saveImage() { const a = document.createElement('a'); a.download='smart-art.png'; a.href=cvs.toDataURL(); a.click(); }

    function fillCanvas(x, y) {
        const c = document.getElementById('color').value;
        const target = {r:parseInt(c.slice(1,3),16),g:parseInt(c.slice(3,5),16),b:parseInt(c.slice(5,7),16)};
        const img = ctx.getImageData(0,0,cvs.width,cvs.height); const data = img.data;
        const pos = (y * cvs.width + x) * 4; const sR = data[pos], sG = data[pos+1], sB = data[pos+2];
        if(sR===target.r && sG===target.g && sB===target.b) return;
        const q = [[x,y]];
        while(q.length){
            const [cx, cy] = q.pop(); const i = (cy * cvs.width + cx) * 4;
            if(cx>=0 && cx<cvs.width && cy>=0 && cy<cvs.height && data[i]===sR && data[i+1]===sG && data[i+2]===sB){
                data[i]=target.r; data[i+1]=target.g; data[i+2]=target.b; data[i+3]=255;
                q.push([cx+1,cy],[cx-1,cy],[cx,cy+1],[cx,cy-1]);
            }
        }
        ctx.putImageData(img,0,0);
    }

    // --- Keyboard Engine ---
    const rows = ["QWERTYUIOP", "ASDFGHJKL", "ZXCVBNM"];
    rows.forEach(r => {
        const div = document.createElement('div'); div.className='kb-row';
        r.split('').forEach(char => {
            const btn = document.createElement('button'); btn.className='key'; btn.innerText=char;
            btn.onmousedown = (e) => { e.preventDefault(); handleInput(char); };
            div.appendChild(btn);
        });
        vk.appendChild(div);
    });

    // --- Game Logic ---
    let score=0, lives=3, stage=1, speed=1.5, gameRunning=false, list=[], timer;
    function handleInput(key) {
        if(!gameRunning) return;
        const idx = list.findIndex(i => i.c === key.toUpperCase());
        if(idx > -1) { score += 10; updateUI(); list[idx].el.remove(); list.splice(idx,1); checkStage(); }
    }

    function checkStage() {
        if(score >= stage * 100) {
            gameRunning = false;
            clearInterval(timer);
            list.forEach(i => i.el.remove());
            list = [];
            if(stage >= 5) {
                document.getElementById('win-overlay').style.display = 'flex';
            } else {
                document.getElementById('stage-complete-text').innerText = "STAGE " + stage + " COMPLETED!";
                document.getElementById('stage-complete-overlay').style.display = 'flex';
            }
        }
    }

    function nextStage() {
        document.getElementById('stage-complete-overlay').style.display = 'none';
        stage++;
        speed += 0.5;
        score = 0;
        gameRunning = true;
        updateUI();
        timer = setInterval(createLetter, 1000);
    }

    function startGame() {
        document.querySelectorAll('.overlay').forEach(o=>o.style.display='none');
        score=0; lives=3; stage=1; speed=1.5; gameRunning=true;
        list.forEach(i=>i.el.remove()); list=[]; updateUI();
        clearInterval(timer); timer = setInterval(createLetter, 1200);
    }

    function createLetter() {
        if(!gameRunning || activeTab!=='typing') return;
        const char = String.fromCharCode(65 + Math.floor(Math.random()*26));
        const div = document.createElement('div'); div.className='letter'; div.innerText=char;
        div.style.left = (Math.random()*75 + 10) + "%"; div.style.top = "-50px";
        document.getElementById('stage-area').appendChild(div);
        list.push({ c: char, el: div, y: -50 });
    }

    function updateUI() {
        document.getElementById('scoreNum').innerText = score;
        document.getElementById('livesText').innerText = "‚ù§Ô∏è".repeat(lives);
        document.getElementById('stageLevel').innerText = stage;
    }

    function gameLoop() {
        if(gameRunning && activeTab==='typing') {
            const h = document.getElementById('stage-area').clientHeight;
            for(let i=list.length-1; i>=0; i--) {
                list[i].y += speed; list[i].el.style.top = list[i].y + "px";
                if(list[i].y > h) {
                    list[i].el.remove(); list.splice(i,1); lives--; updateUI();
                    if(lives<=0) { gameRunning=false; clearInterval(timer); document.getElementById('game-over').style.display='flex'; }
                }
            }
        }
        requestAnimationFrame(gameLoop);
    }

    window.addEventListener('keydown', (e) => { 
        hideVK(); 
        if(activeTab === 'typing') handleInput(e.key); 
    });

    gameLoop();
</script>
</body>
</html>
